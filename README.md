# 협동로봇 설계 및 분류 시스템

## 프로젝트 개요

**요약 설명**: 컨베이어 벨트 위 물체(캔, 유색/투명 유리 등)를 카메라로 인식하고, Franka 로봇 팔이 ROS2 MoveIt 기반 경로 계획을 통해 자동으로 분류·적재하는 협동로봇 시스템 구현.

- **기간**: 2024.12.01 \~ 2024.12.21
- **참여 인원**: 3명 (비전: 이재욱; 로봇 제어: 박상언, 박상현)
- **사용 기술**: C++, ROS2, MoveIt, YOLO, Franka 로봇 팔/Gripper, 뎁스 카메라
- **프로젝트 목적**: 협동로봇을 활용한 자동 분류·적재 기술을 실습하고, 실제 산업 환경에서 다양한 작업에 적용 가능한 ROS2 기반 로봇 제어 및 비전 통합 역량을 습득.
- **결과물**: 컨베이어 벨트 위 물체(캔, 유색/투명 유리 등)를 자동으로 분류·적재하는 협동로봇 시스템 구현.

## 주요 기여 
franka_pickandplace.cpp 코드를 작성하며
- ROS2 DDS 통신으로 비전 데이터 토픽 수신 및 Franka Gripper 제어 최적화.
- YOLO로 추출한 각도값(`pAngle`)을 로봇 RPY 좌표로 변환하여 정확한 위치 계산.
- 4개의 물체 종류별 자동 분류 Pick & Place 구현.

## 문재 해결

- **문제 1: 로봇 제어와 데이터 수신 병행**\
  로봇 제어 중 데이터 수신을 동시에 처리해야 했음.\
  **해결**: C++ 멀티스레딩을 사용하여 MoveIt 경로 계획과 ROS2 데이터 수신을 병렬 처리, 제어 지연 없이 안정적 동작 확보.

- **문제 2: 복잡한 물체 위치에서 MoveIt 경로 계획 실패**\
  복잡한 물체 위치에서 MoveIt 경로 계획 실패.\
  **해결**: `joint1` ±π/3 범위 제한과 스텝 크기 0.01m 조정으로 조인트 리미트 및 싱귤러 자세 회피로 경로 계획 성공률 향상.

- **문제 3: PC 간 통신 지연**\
  `Team02_Ros2Topic` 데이터 전송 지연 (WiFi).\
  **해결**: ROS2 메시지 큐 최적화와 단일 수신 플래그(`data_received_`)로 지연 0.3초 → 0.1초 단축.

- **문제 4: 카메라-로봇 각도 변환**\
  카메라 각도값이 로봇 좌표계와 불일치.\
  **해결**: `pAngle`을 RPY 변환(`M_PI * pAngle / 180`)으로 로봇 각도값 계산.

## 기술 스택

| **카테고리** | **기술** |
| --- | --- |
| 프로그래밍 | C++ |
| 프레임워크 | ROS2, MoveIt, YOLO |
| 하드웨어 | Franka 로봇 팔, Gripper, 뎁스 카메라 |
| 통신 | ROS2 DDS (UDP/IP, WiFi), Franka TCP (LAN 케이블) |
| 도구 | Git, RViz |

## 프로젝트 성과

- **분류 성과**: 캔, 유색/투명 유리 등 4종 물체를 8초 이내 분류, 30회 실험 중 90% 성공률.
- **기술적 기여**: 비전 데이터 수신, 각도 변환, 실시간 로봇 제어 구현.
- **시연 성공**: 실험실에서 안정적 Pick & Place 시연.

## 데모 및 시각 자료

- **로봇 구동**: 컨베이어 벨트 위 물체 분류 (파지점 대기 **→** 토픽 수신 **→** End-effect 각도 조정 **→** 카르테시안 경로 이동 (컨베이어 위 → 아래)  **→** 그리핑 **→** 카르테시안 경로 이동 (컨베이어 아래 →위) →기본 위치 복귀 **→** 바구니 이동 (종류별 목표)**→**  그리퍼 오픈 **→** 다시 파지점 대기).
<img width="771" height="572" alt="franka1" src="https://github.com/user-attachments/assets/eb27af88-4505-4875-8719-68df2bcb5e89" />

  
- **시스템 아키텍처 및 노드 그래프**
![franka2](https://github.com/user-attachments/assets/a3121363-4dbe-4c16-b12f-dd7221a55747)

## 연락처

- **이메일**: jacob7575@senestechnology.com
- **GitHub**: github.com/pqrstuhij

본 프로젝트는 ROS2, MoveIt 기반의 비전-통신-제어 통합 역량을 보여줍니다. `franka_pickandplace.cpp`의 전체 코드를 작성하였으며, 상세 내용은 리포지토리에서 확인 가능합니다. 문의는 이메일로 부탁드립니다.
